import{p as e,a as t,V as n,M as a,G as o,L as i,B as s,t as r,r as l,o as c,b as d,W as m,P as u,S as p,w as h,c as f,d as g,e as w,f as v,g as y,F as x,h as b,A as M,i as _,u as L,j as X}from"./vendor.9201f5d6.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const a=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,i)=>{const s=new URL(e,a);if(self[t].moduleMap[s])return n(self[t].moduleMap[s]);const r=new Blob([`import * as m from '${s}';`,`${t}.moduleMap['${s}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){i(new Error(`Failed to import: ${e}`)),o(l)},onload(){n(self[t].moduleMap[s]),o(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("/assets/");function Y(e,t){return Math.round(e*10**t)/10**t}e("data-v-ffdff048"),t();var z=function(e,t){let a,o=!1,i=0,s=0;t.oncontextmenu=function(e){e.preventDefault()},t.addEventListener("mousedown",(function(t){2==t.button&&(o=!0,i=t.clientX,s=t.clientY,a=new n(e.position.x,e.position.y,e.position.z))})),t.addEventListener("mouseup",(function(e){o=!1})),t.addEventListener("mousemove",(function(n){if(o){let o=n.clientX-i,r=n.clientY-s,l=t.offsetHeight,c=t.offsetWidth,d=e.position.z*Math.tan(e.fov/360*Math.PI)*2,m=e.aspect*d;e.position.set(a.x-o/c*m,a.y+r/l*d,a.z)}})),t.addEventListener("mousewheel",(function(t){e.position.set(e.position.x,e.position.y,e.position.z-t.wheelDelta/40)}))};function I(e,t,n=1){const a=t/180*Math.PI;return{x:(e.x*Math.cos(a)-e.y*Math.sin(a))*n,y:(e.x*Math.sin(a)+e.y*Math.cos(a))*n}}function S(e,t,r=20,l=1,c={}){const d=new a(c),m=new o,u=new i((new s).setFromPoints([new n(e.x,e.y,0),new n(t.x,t.y,0)]),d),p={};p.x=t.x-e.x,p.y=t.y-e.y;const h=l/Math.sqrt(p.x**2+p.y**2),f=I(p,r,h),g=I(p,-r,h),w=new i((new s).setFromPoints([new n(t.x-f.x,t.y-f.y,0),new n(t.x,t.y,0),new n(t.x-g.x,t.y-g.y,0)]),d);return m.add(u),m.add(w),m}const E=b("data-v-2e9d98e1");e("data-v-2e9d98e1");const P=w("br",null,null,-1);t();const N={expose:[],props:{src:String,canvasId:String,height:{type:Number,default:100},width:{type:Number,default:100},initX:{type:Number,default:0},initY:{type:Number,default:0},initZ:{type:Number,default:100},minZ:{type:Number,default:1},maxZ:{type:Number,default:2e3},tagX:{type:Number,default:0},tagY:{type:Number,default:0},showInfo:{type:Object}},setup(e){const t=e,o=r(t),b={renderer:null,camera:null,scene:null,controls:null,canvas:null},_=l({gpsX:0,gpsY:0,simX:0,simY:0,closest_lane_id:null});let L;function X(){b.camera.position.z=Math.min(t.maxZ,b.camera.position.z),b.camera.position.z=Math.max(t.minZ,b.camera.position.z),requestAnimationFrame(X),I()}function I(){b.renderer.render(b.scene,b.camera)}const N=new Map;function D(e){const t=N[e];for(let n=0;n<t.length;n++){const e=t[n];e.material.color.r=e.material.color.r/15*8,e.material.color.g=e.material.color.g/15*8,e.material.color.b=e.material.color.b/15*8}}function j(e){const t=N[e];for(let n=0;n<t.length;n++){const e=t[n];e.material.color.r=e.material.color.r/8*15,e.material.color.g=e.material.color.g/8*15,e.material.color.b=e.material.color.b/8*15}}return c((()=>{b.canvas=document.getElementById(t.canvasId),b.canvas.onmousemove=e=>{const n=function(e){let t=b.camera.position.z*Math.tan(b.camera.fov/360*Math.PI)*2,n=b.camera.aspect*t,a=b.camera.position.x,o=b.camera.position.y,i=e.pageY,s=e.pageX,r=b.canvas.offsetTop,l=b.canvas.offsetLeft,c=b.canvas.offsetHeight;return{x:(s-l)/b.canvas.offsetWidth*n-n/2+a,y:t/2-(i-r)/c*t+o}}(e);_.gpsX=Y(n.x,3),_.gpsY=Y(n.y,3),_.simX=Y(n.x-t.initX,3),_.simY=Y(n.y-t.initY,3),d.get("http://127.0.0.1:5000/get_closest_lane",{params:{x:n.x,y:n.y}}).then((e=>{_.closest_lane_id!=e.data.id&&(null!=_.closest_lane_id&&D(_.closest_lane_id),j(e.data.id)),_.closest_lane_id=e.data.id}))},b.canvas.onclick=e=>{},_.tagX=b.canvas.offsetX,_.tagY=b.canvas.offsetY,b.renderer=new m({canvas:b.canvas}),b.renderer.setSize(t.width,t.height),b.camera=new u(45,t.width/t.height,1,2e3),b.camera.position.set(0,0,100),b.camera.rotation.set(0,0,0),b.camera.up.y=1,b.camera.updateProjectionMatrix(),b.camera.position.set(t.initX,t.initY,t.initZ),b.scene=new p,b.controls=new z(b.camera,b.renderer.domElement),b.renderer.render(b.scene,b.camera),d.get(t.src).then((e=>{console.log(e),globalData.data=e.data,L=e.data,globalData.mapData=L,function(){for(const e in L.lane){const t=L.lane[e];N[t.id.id]=[];let o=[];for(const e in t.leftBoundary.curve.segment[0].lineSegment.point){const a=t.leftBoundary.curve.segment[0].lineSegment.point[e];o.push(new n(a.x,a.y,0))}let r=(new s).setFromPoints(o),l=new i(r,new a({color:8947848}));N[t.id.id].push(l),b.scene.add(l),o=[];for(const e in t.rightBoundary.curve.segment[0].lineSegment.point){const a=t.rightBoundary.curve.segment[0].lineSegment.point[e];o.push(new n(a.x,a.y,0))}r=(new s).setFromPoints(o),l=new i(r,new a({color:8947848})),N[t.id.id].push(l),b.scene.add(l);for(let e=0;e<t.centralCurve.segment[0].lineSegment.point.length-1;e++){let n=S(t.centralCurve.segment[0].lineSegment.point[e],t.centralCurve.segment[0].lineSegment.point[e+1],void 0,void 0,{color:34816});for(let e=0;e<n.children.length;e++)N[t.id.id].push(n.children[e]);b.scene.add(n)}}globalData.threeElements=b,globalData.highlightLane=j,globalData.unhighlightLane=D,globalData.mapElements=N}(),I()})),X()})),h([o.width,o.height],(([e,t])=>{b.renderer.setSize(e,t),b.camera.aspect=e/t,b.camera.updateProjectionMatrix(),b.renderer.render(b.scene,b.camera)})),h(o.showInfo.path,(e=>{console.log("watched",e);for(let t=0;t<e.path.length;t++){const a=e.path[t];new M(new n(Math.cos(a.transform.rotation.z),Math.cos(a.transform.rotation.z),0),new n(a.transform.position.x,a.transform.position.y,0),1,16776960)}})),E(((t,n)=>(f(),g(x,null,[w("div",{style:[{color:"white",position:"absolute",padding:"10px"},{left:e.tagX+"px",top:e.tagY+"px"}]},[v(" POSITION: ("+y(_.simX)+", "+y(_.simY)+") ",1),P,v(" LANE_ID: "+y(_.closest_lane_id),1)],4),w("canvas",{id:e.canvasId},null,8,["id"])],64))))},__scopeId:"data-v-2e9d98e1"};X({expose:[],setup(e){let t=_("http://localhost:5000"),n=_(60),a=l({});function o(){return console.log(window.innerWidth,window.innerWidth-n.value),window.innerWidth-n.value}function i(){return window.innerHeight}const s=l({width:o(),height:i()});return window.onresize=function(){s.width=o(),s.height=i()},c((()=>{document.getElementById("get-path").onclick=()=>{d.get(t.value+"/record").then((e=>{console.log("request record",e),a.path=e.data.path}))}})),(e,o)=>(f(),g(x,null,[w("div",{style:{width:L(n)+"px",height:"100vh"}},[w("button",{id:"get-path",type:"",style:{width:L(n)+"px",height:L(n)+"px"}}," 获取路径 ",4)],4),w(N,{src:L(t)+"/map","canvas-id":"canvas-1",height:s.height,width:s.width,"init-x":0,"init-y":0,"tag-x":L(n),"show-info":L(a)},null,8,["src","height","width","tag-x","show-info"])],64))}}).mount("#app");
